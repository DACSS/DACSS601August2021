---
title: "Noah Homework 5"
description:  |  
  HW Five.
author:
-name: Noah Milstein
date: 08-19-2021
output:
  distill::distill_article:
    self_contained: false
draft: true
---

## Research Problem

The Research Problem I will be addressing relates to nation debt in the United over the past two decades. Leading up to and after the financial crisis debt has become an important topic in economics. Since the financial crisis was largely caused by debtors being allowed more credit than they were able to pay back, it is important to ensure that the country is not following a similar path economically.

# How I will be analyzing the probelem

In order to estimate extent to which debt has increased in the economy recently compared to the past I will compare united states national debt  to GDP or gross domestic product. 

Specifically I wanted to see which ones had increased the most in the last few years relative to one another, and if any sectors have reached a similar level to what spurred the 2008 financial crisis. This issue is important on a macro scale as the general consensus seems to be that debt is excessive throughout the economy, especially on the consumer side. Because of this it is important to see how debt has changed in comparison to what the economy is actually able to produce. Excess debt largely implies that people have to borrow beyond income limitations, which could eventually have limits.

I would argue that debt has returned to its pre-crisis highs and represents a threat to economic stability in the United States. Specifically I would argue that housing market debt is likely nearing unsustainable levels once again. In addition, upticks in other forms of debt have likely increased in comparison to what we produced, which could indicate a looming crisis or a coming inhibitor to non-debt fuled economic growth.


## My Data

The dataset I chose for my final project relates to household debt in the United States, it comes from the New York Federal Reserve in quarterly data since 2003 and is reported in the trillions. I am very much interested in the increasing use of debt in the economy to inflate the value of a variety of sectors and give the impression of economic well being. Because of this is wanted to start by analyzing the FED data regarding the basic kinds of debt in comparison to one another and income to see how various forms of debt have been increasing.


```{r, Include-FALSE, Echo=FALSE}
library(knitr)
library(readxl)
library(tidyverse)
library(sjmisc)
library(ggplot2)
library(dplyr)
library(ggthemes)
library(lubridate)
library(ggrepel)
library(ISLR)
library(psych)
```


```{r, Echo=FALSE}
#as a preliminary part of my data cleaning I created a numeric sequence going 
#from 1 to 74 to represent the number of quarters since 2002:Q4, I will later 
#clean the FED data to use their version of the column

values_before_date_modification<-seq(1:74)
#This first excel sheet contains the information regarding debt
total_debt_plus_comp_raw_NM <- read_excel(
  "~/Desktop/DACSS601HW/DACSS601August2021/_data/total_debt_plus_comp_raw_NM.xlsx"
  )
#This excel contains GDP information
GDP_FED_trills <- read_excel(
  "~/Desktop/DACSS601HW/DACSS601August2021/_data/GDP_FED_NOAH.xls"
  )

```

## My Variables
 
The above code loads in the two datasets I will be using for this project. The first "total_debt_plus_comp_raw_NM" contains data from the federal reserve regarding cumulative debt in the united states in trillions of dollars. It is broken down into the Year and Quarter in which the observation was recorded. It is subdivided into columns by Mortgage, HE Revolving, Auto Loan, Credit Card, Student Loan, Other, and Total debt.

The second of the two datasets "GDP_FED_trills" contains yearly GDP data also broken down into quarterly data.

```{r, Echo=FALSE}
GDP_Rows_Removed_to_Q4_2002<-GDP_FED_trills[-c(1:234),]

# First unneeded observation not included in the debt sheet are removed from GDP

GDP_Rows_Removed_to_Q4_2002<-GDP_Rows_Removed_to_Q4_2002[-c(1)]

# Next the First column is removed because it does not contain data

names(GDP_Rows_Removed_to_Q4_2002)[1] <- "Total_GDP_Billions"

# After this I rename the column that has become the first one into 
#"Total_GDP_Billions"

GDP_Rows_Removed_to_Q4_2002$Quarters_Since_Q4_2002<-values_before_date_modification

# Next to the GDP I add my sequence of number 
#from 1 to 74 representing the number of quarters 
#since Q4 2002 which is a bootstrap method of creating a time variable

transform(
  GDP_Rows_Removed_to_Q4_2002,as.integer(
    GDP_Rows_Removed_to_Q4_2002$Total_GDP_Billions
                                         ))

GDP_Rows_Removed_to_Q4_2002_numeric <- transform(
  GDP_Rows_Removed_to_Q4_2002, Total_GDP_Billions = as.numeric(Total_GDP_Billions
                                                               ))
# Next I convert the column "Total_GDP_Billions" into an integer as it was initially a character

GDP_Rows_Removed_to_Q4_2002_trillions <- GDP_Rows_Removed_to_Q4_2002_numeric %>% 
  mutate(
  Total_GDP_Trillions = Total_GDP_Billions/1000
  ) 

# The final part of the section of data cleaning is to convert my 
#GDP Data represented in billions into trillions by diving 
#by 1000. This is because my debt data is in trillions and the smaller 
#integers will be simpler to graph.

```


The lines of code above are the initial cleaning process for the Federal reserve GDP data. Because of the nature of the excel file it came in I had to remove the first 234 rows because they either contained no data, as in the case of the first 3 which just had descriptions and citations from the federal reserve, and the other because they represented data outside of the scope of the NY-FED data regarding debt. The Debt data only goes back to 2002, while the GDP data goes back to the 1980s.


```{r}
tdpcr_NM_Minus_2_rows<-total_debt_plus_comp_raw_NM[-c(1,2,3),]

# The line above deletes the first 3 rows of text containing no observations from the dataset

tdpcr_NM_Minus_2_rows<-tdpcr_NM_Minus_2_rows[-c(9)]

#the line above deletes the 9th column which contains one box of text and no observations

names(tdpcr_NM_Minus_2_rows)[1] <- "Year and Quarter"
names(tdpcr_NM_Minus_2_rows)[2] <- "Mortgage"
names(tdpcr_NM_Minus_2_rows)[3] <- "HE Revolving"
names(tdpcr_NM_Minus_2_rows)[4] <- "Auto Loan"
names(tdpcr_NM_Minus_2_rows)[5] <- "Credit Card"
names(tdpcr_NM_Minus_2_rows)[6] <- "Student Loan"
names(tdpcr_NM_Minus_2_rows)[7] <- "Other"
names(tdpcr_NM_Minus_2_rows)[8] <- "Total"

# The lines above create new replacement names for the lost variables from the row deletion 

tdpcr_NM_Minus_2_rows$Quarters_Since_Q4_2002<-values_before_date_modification

# The final line of code adds the list of 1 through 74 number representing the quarters since Q4 2002

```

The portion of code above involves the next step of my data cleaning with the Debt Spreadsheet. Like GDP the first few rows did not contain data and simply descriptive text from the Fed. In addition column 9 had descriptive text and needed to be deleted. This deletion necessitated that the columns also be renamed to their original category.


```{r}
# Next I will do a Full join to get my data frames into the same data frame 
#using my "Quarters_Since_Q4_2002" variable (1-74)

complete_spreadsheet_GDP_Debt<-full_join(
  GDP_Rows_Removed_to_Q4_2002_trillions, tdpcr_NM_Minus_2_rows, by = "Quarters_Since_Q4_2002"
  )

#Next each column of debt data is converted from character to numeric data for
# later analysis

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, Mortgage = as.numeric(
    Mortgage
                                                       ))

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, HE.Revolving = as.numeric(
    HE.Revolving
    ))

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, Auto.Loan = as.numeric(
    Auto.Loan
    ))

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, Credit.Card=as.numeric(
    Credit.Card
    ))

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, Student.Loan=as.numeric(
    Student.Loan
    ))

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, Other=as.numeric(
    Other
    ))

complete_spreadsheet_GDP_Debt <- transform(
  complete_spreadsheet_GDP_Debt, Total=as.numeric(
    Total
    ))

```

```{r}
# The next step in my data cleaning is to fix the quarters column, first I add a 20 onto the end of each line to make the dates into a 4 digit year

complete_spreadsheet_GDP_Debt <- 
  complete_spreadsheet_GDP_Debt %>% 
  mutate(
    paste(
    "20", "Year.and.Quarter" , sep=""
    ))

# Next I use the yq function to make the data into year and quarter data

complete_spreadsheet_GDP_Debt<-complete_spreadsheet_GDP_Debt %>% mutate(
  Quarter= yq(
    Year.and.Quarter
    ))

```


```{r, Echo=FALSE}

#The following lines each create a new column representing each types 
#of Debt's percent share of the total for each year and add them to the data frame

complete_spreadsheet_GDP_Debt<-mutate(
  complete_spreadsheet_GDP_Debt,
       Percent_Mortgage = Mortgage / Total
  ) 

complete_spreadsheet_GDP_Debt<-mutate(
  complete_spreadsheet_GDP_Debt,
       Percent_HE.Revolving = HE.Revolving / Total
  ) 

complete_spreadsheet_GDP_Debt<-mutate(
  complete_spreadsheet_GDP_Debt,
       Percent_auto = Auto.Loan / Total
  ) 

complete_spreadsheet_GDP_Debt<-mutate(
  complete_spreadsheet_GDP_Debt,
       Percent_Credit.Card = Credit.Card / Total
  ) 

complete_spreadsheet_GDP_Debt<-mutate(
  complete_spreadsheet_GDP_Debt,
       Percent_Student.Loan = Student.Loan / Total
  ) 

complete_spreadsheet_GDP_Debt<-mutate(
  complete_spreadsheet_GDP_Debt,
       Percent_Other = Other / Total
  ) 
```

The code above changes each column's data from character to numeric values as the full_join caused the data to become exclusively defined as character variables.

## Understanding the variables

The line of code below shows each variable in the data frame that is used in the data analysis


```{r}
complete_spreadsheet_GDP_Debt %>% select(
  c(
    "Mortgage", "HE.Revolving", "Auto.Loan", "Credit.Card", 
    "Student.Loan", "Other", "Total", "Quarter"
    )
  ) %>%
colnames() %>% kable()
```

The following variables come from the Federal Reserve's *Quarterly Report on Household Debt and Credit*

The FED describes each type of debt as follows:

* **Mortgage**: The sum of these loans "include all mortgage installment loans, including first mortgages and home equity installment loans (HEL), both of which
are closed-end loans."

* **HE.Revolving**: HE.Revolving is similar to mortgage, but "unlike home equity installment loans," revolving loans "are home equity loans with a revolving line of credit where the borrower can choose when and how often to borrow up to an updated credit limit."

* **Auto.Loan**: Automobile loans are "loans taken out to purchase a car, including leases, provided by automobile dealers and automobile financing companies."(Federal Reserve of New York)

* **Credit.Card**: Credit card debt is a measurement of "revolving accounts for banks, bankcard companies, national credit card companies, credit unions and savings & loan associations" indicating the amount of debt held by people in those types of account.

* **Student.Loan**: Student loans "include loans to finance educational expenses provided by banks, credit unions and other financial institutions as well as federal and state governments" for the purpose of paying for schooling, especially higher education.

* **Other**: The "Other" category of debt "includes Consumer Finance (sales financing, personal loans) and Retail (clothing, grocery, department stores, home furnishings, gas etc) loans," which are outside the definite guidelines of the other types.

* **Total**: The Total variable includes the sum of all loans across the economy in all sectors. 

* **Quarter**: The Quarterly observation in the dataset is simply the quarter and respective year when each observation was made by the FED. The first quarter of the year is represented by the structure 2003-01-01 with the first day of the first month representing the first quarter, 04-01 representing the second quarter, 07-01 the third and 10-01 the fourth. Each of these observations is the first day of the quarter, but represents the entirety of each type of loan taken out between the beginning date and the final day of that quarter.

(Federal Reserve of New York)

```{r}
complete_spreadsheet_GDP_Debt_pL_with_mort <-pivot_longer(
  complete_spreadsheet_GDP_Debt, cols=c(                        
"Mortgage",                                       
"HE.Revolving",                                   
"Auto.Loan",                                      
 "Credit.Card",                                    
 "Student.Loan",                                   
"Other",                                          
),                                          
names_to="debt_type", 
values_to="debt_amount")                                       

complete_spreadsheet_GDP_Debt_pL_wo_mort <- pivot_longer(
  complete_spreadsheet_GDP_Debt, cols=c(                        
"HE.Revolving",                                   
"Auto.Loan",                                      
 "Credit.Card",                                    
 "Student.Loan",                                   
"Other",                                          
),                                          
names_to="debt_type", 
values_to="debt_amount") 


complete_spreadsheet_GDP_Debt_Total<- pivot_longer(
  complete_spreadsheet_GDP_Debt, cols=c(                        
"Total"                                          
),                                          
names_to="debt_type", 
values_to="debt_amount") 
     
```

### Statistics Associated With Each Variable


```{r}
complete_spreadsheet_GDP_Debt %>% select(
  c(
  "Mortgage", "HE.Revolving", "Auto.Loan", 
  "Credit.Card", "Student.Loan", "Other"
  )) %>%
describe(
  na.rm = TRUE
  ) %>% select(c("n", "mean", "sd", "median", "mad", "min", "max", "range" )) %>% kable()
```


## Data Visualization

The following graphs depict the movement of each of a number of forms of debt, measured in trillions of dollars, over time from Quarter 4 2002 to the 2nd Quarter of 2021. I used geom_smooth() in my analysis along with ggplot() because each form of debt only has one observation for each year, thus a regression or geom_smooth() over  geom_points() would not provide any additional information. Nor would an independently generated linear model.

### Graph 1

The first graph below depicts the relationship between time in Quarters and total debt in trillions for each debt type including "Mortgage", "HE.Revolving", "Auto.Loan",  "Credit.Card", "Student.Loan", and "Other"                                                  

```{r}
complete_spreadsheet_GDP_Debt_pL_with_mort %>%
ggplot()+
  geom_smooth(
    mapping=aes(
    `Quarter`, `debt_amount`, color=`debt_type`,  group=`debt_type`
    ))+ 
  labs(
    title="Relationship Between Time and All Debt Types ",  
    y= "Loan Volume (Trillions) ", x="Time Since Q4 2002 (Quarters)")
 
```

The graph illustrates a great deal about the data. Each type of debt besides mortgage occupies a relatively small amount compared to loans involving property. However, it is clear from the geom_smooth()s that auto loans and student loans have increased beyond all types of debt beyond mortgage. 

The graph also indicates that the cumulative mortgage debt reached a peak in 2008 and then fell sharply following the crisis and has returned to a point larger than it was before the crisis. It is also the only graph that appears to have extreme peaks and troughs that could not be explained through a purely linear increase.

### Graph 2

The next graph is largely the same as the previous, but with the additional of Total GDP. In this case GDP and debt appear to be moving farther apart.

```{r}
complete_spreadsheet_GDP_Debt_pL_with_mort %>%
ggplot()+
  geom_smooth(
    mapping=aes(
    `Quarter`, `debt_amount`, color=`debt_type`,  group=`debt_type`
    )) + geom_smooth(
    mapping=aes(
      x=`Quarter`, y=`Total_GDP_Trillions`, color="Total GDP"
      ))+ labs(
        title="Relationship Between All Types of Debt and Total GDP",  
        y= "Loan Volume (Trillions)", x="Time Since Q4 2002 (Quarters)")
 
```



### Graph 3

The following graph examines this relationship more directly comparing Total GDP to Total debt, it appears these two lines became closest leading up to and during the period between 2006 and 2008 when the crisis began. The two lines appear to be approaching again as the Total debt line, in this case labeled "Total" has a positive slope.

```{r}
complete_spreadsheet_GDP_Debt_Total %>%
ggplot()+
  geom_smooth(
    mapping=aes(
      `Quarter`, `debt_amount`, color=`debt_type`,  group=`debt_type`
      ))+ 
  geom_smooth(
    mapping=aes(
      x=`Quarter`, y=`Total_GDP_Trillions`, color="Total GDP"
      ))+ 
  labs(title="Relationship Between Time and Total Debt Compared to Total GDP",  
       y= "Loan Volume (Trillions) ", x="Time Since Q1 2002 (Quarters)")
 
```

### Graph 4

The graph below illustrates all debt types but mortgage to better show the trends within this group, which was difficult to comprehend in the above graphs because the geom_smooth()s were compressed at the bottom of the graph as mortgage has a far greater volume than any of them.

```{r}
complete_spreadsheet_GDP_Debt_pL_wo_mort %>%
ggplot()+
  geom_smooth(
    mapping=aes(
    `Quarter`, `debt_amount`, color=`debt_type`,  group=`debt_type`
    ))+ labs(
      title="Relationship Between Time and All Forms of Debt Except Mortgage",  
      y= "Loan Volume (Trillions) ", x="Time Since Q1 2002 (Quarters)")
```

The graph indicates a positive slope for Auto Loans, student loans, and credit card debt along with the "other" category. The only type of loan that appears to be decreasing is the Revolving loan category.

### Graph 5

The graph below indicates a similar pattern when comparing "Total GDP" to all types of debt except for Mortgage debt. In this case it appears that the pace of GDP growth is larger than the growth of any individual form of debt besides mortgage debt.

```{r}
complete_spreadsheet_GDP_Debt_pL_wo_mort %>%
ggplot()+
  geom_smooth(
    mapping=aes(
    `Quarter`, `debt_amount`, color=`debt_type`,  group=`debt_type`
    )) + 
  geom_smooth(
    mapping=aes(
      x=`Quarter`, y=`Total_GDP_Trillions`, color="Total GDP"
      ))+ 
  labs(
    title="Relationship Between Time and All Forms of Debt Except Mortgage and Total GDP",  
    y= "Loan Volume (Trillions) ", x="Time Since Q1 2002 (Quarters)")
```
# Density Plots

### First Density Plot

The First density plot compares all debt types besides mortgage loans. In this distribution is it clear that student debt since 2002 has been most densely concentrated near the higher amounts of debt, while auto loans are high as well when compared to the other three.
 
```{r}
 ggplot(complete_spreadsheet_GDP_Debt_pL_wo_mort, aes(
   debt_amount
   ))+
  geom_density(
    aes(
      fill=factor(debt_type)
      ), alpha=0.8) + 
  labs(
    title="Density plot of All Forms of Debt Except Mortgage",  
    y= "Density", x="Debt Volume")
```
 
### Second Density Plot

The Second density plot compares all debt types. In this distribution is it clear that mortgage since 2002 has been most densely concentrated near the higher amounts of debt. Similarly to smoothed plots the density plot illustrates that all other types of debt besides mortgage are highly concentrated near the lower end of debt. while auto loans are high as well when compared to the other three.
 
```{r}
 ggplot(complete_spreadsheet_GDP_Debt_pL_with_mort, aes(debt_amount))+
  geom_density(aes(fill=factor(debt_type)), alpha=0.8)+
  labs(title="Density plot of All Forms of Debt",  
       y= "Density", x="Debt Volume")

``` 

 
## Conclusion

## Reflection

## Citations

Federal Reserve of New York, *Quarterly Report on Household Debt and Credit 2021:Q2*,  August, 2021, New York, New York, FED.

U.S. Bureau of Economic Analysis, *Gross Domestic Product [GDP]*, FRED, Federal Reserve Bank of St. Louis.













