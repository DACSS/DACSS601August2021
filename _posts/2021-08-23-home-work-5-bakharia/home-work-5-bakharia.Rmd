---
title: "Home Work 5 - bakharia"
description: |
  Since 2008, guests and hosts have used Airbnb to expand on traveling possibilities and present more unique, personalized way of experiencing the world. This dataset describes the listing activity and metrics in NYC, NY for 2019. This data file includes all needed information to find out more about hosts, geographical availability, necessary metrics to make predictions and draw conclusions. 
author: Shubham Mishra
date: 08-23-2021
categories:
- homework 5
- AB_NYC_2019
- bakharia
output:
  distill::distill_article:
    self_contained: false
draft: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
```
**Reading the dataset and rearranging the columns**
```{r}
ab_nyc <- read.csv("../../_data/AB_NYC_2019.csv") %>%
  relocate(c("latitude", "longitude", "id", "name", "host_id", "host_name", "neighbourhood_group", "neighbourhood", "room_type", "minimum_nights", "number_of_reviews", "last_review", "reviews_per_month", "calculated_host_listings_count", "availability_365"))

head(ab_nyc)
```
**Finding out the least expensive stay at a bnb by multiplying the cost/night with the min no days for staying**
```{r}
min_cost <- st_as_sf(as.data.frame(ab_nyc$minimum_nights * ab_nyc$price) 
                     %>% `colnames<-`(c("Minimum Cost of Stay")) 
                     %>% mutate(lat = ab_nyc$latitude, lon = ab_nyc$longitude) 
                     %>% select(lat, lon, `Minimum Cost of Stay`),
                    coords = c("lon", "lat"),
                     crs = "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
                     )
```
**Using summary to specify the affordability of each place (#1 <= 135, #2 <= 300, #3 <= 734, #4 > 734) **
```{r}
summary(min_cost)
```

```{r}
info <- summary(min_cost)
#as.numeric(str_extract(info[3], "[0-9]+"))
min_cost <- min_cost %>%
  mutate(Affordability = case_when(
    `Minimum Cost of Stay` <= as.numeric(str_extract(info[2], "[0-9]+")) ~ 1,
    `Minimum Cost of Stay` <= as.numeric(str_extract(info[3], "[0-9]+")) ~ 2,
    `Minimum Cost of Stay` <= as.numeric(str_extract(info[5], "[0-9]+")) ~ 3,
    `Minimum Cost of Stay` > as.numeric(str_extract(info[5], "[0-9]+")) ~ 4
  ))
```
**Mapping all the places based on the affordability using the lat and long provided in the dataset using the mapview library**
```{r}
library(mapview)
min_cost %>%
  select(geometry, Affordability) %>%
  mapview(zcol = "Affordability")
```
**Using groupby and summarise to find out the owners who own most no of bnbs in the city**
```{r}
                  #as.data.frame(table(ab_nyc$host_id)) %>% `colnames<-`(c("host_id","No. of Places"))
no_of_places <- as.data.frame(ab_nyc %>% group_by(host_id,host_name) %>% summarise(n = n()) %>% `colnames<-`(c("host_id", "host_name", "No. of Places")))
no_of_places %>%
  arrange(desc(`No. of Places` ))%>%
  slice(1:10)%>%
  ggplot(aes(host_name,`No. of Places`, fill=as.character(host_id))) +
  geom_bar(stat = "identity") + theme_minimal() + coord_flip() + 
  labs(x = "Host Name", fill = "Host ID")
```
**Find the relation number of listings at place with the experience with the of owner(based on number of places owned). It is found that the avg_listings by the experienced owner(having multiple bnbs) is more. The graph from above remains the same**
```{r}
no_of_places %>%
  mutate(listings = sapply(host_id,function(x){return (sum(ab_nyc[ab_nyc$host_id == as.numeric(x), "calculated_host_listings_count"]))}))%>%
  mutate(avg_listings = listings/`No. of Places`) %>%
  arrange(desc(avg_listings)) %>%
  slice(1:10) %>%
  ggplot(aes(host_name,avg_listings, fill = as.character(host_id))) +
  geom_bar(stat = "identity") + theme_minimal() +
  labs(x = "Host Name", y = "Avg Listings", fill = "Host ID") + coord_flip()
```
**On categorisingon the basis of privacy(shared room~ shared, private room~ Room, Entire Place ~ Entire), it is found that the most number of bnbs offer the entire place.**
```{r}
ab_nyc %>%
  mutate(Type = case_when(
    str_extract(room_type, "[^\\s]+") == "Shared" ~ "Shared",
    str_extract(room_type, "[^\\s]+") == "Private"~ "Room",
    str_extract(room_type, "[^\\s]+") == "Entire" ~ "House/Apt"
  )) %>%
  ggplot(aes(Type)) +
  geom_bar(aes(fill = Type)) + theme_minimal() 
```
**On categorising all the bnbs based on the neighbourhood that they are in, it is found that Manhattan has the most number of bnbs**
```{r}
ab_nyc %>%
  group_by(neighbourhood_group) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count))%>%
  ggplot(aes(neighbourhood_group, Count, fill = neighbourhood_group)) +
  geom_bar(stat = "identity") + theme_minimal()
```

